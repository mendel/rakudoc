#! /usr/bin/env raku

use Rakudoc;
use Rakudoc::CMD :MAIN;
my %*SUB-MAIN-OPTS = :named-anywhere;

# To have 'rakudoc rakudoc' work naturally, the main Pod is here; in order
# to keep all the 'multi MAIN' subs in Rakudoc::CMD, here's essentially a
# global variable giving access to USAGE(). Perhaps in the future a simpler
# mechanism can be devised.
my &*USAGE = &USAGE;
sub USAGE(Bool :$okay, Rakudoc :$rakudoc) {
    say $*USAGE;

    if $rakudoc {
        print "\nDoc directory:\t{$rakudoc.doc-source.join("\n\t\t")}\n";
    }

    require Pod::To::Text;
    say "\n", ::("Pod::To::Text").render($=pod);
    exit $okay ?? 0 !! 2;
}


=begin pod

=head1 NAME

B<rakudoc> - Read Raku documentation

=head1 SYNOPSIS

    rakudoc List
    rakudoc List.reduce
    rakudoc .reduce

=head1 ENVIRONMENT

C<RAKULIB> (through Raku's C<$*REPO> variable) is used to find modules and
documentation.

C<RAKUDOC> is a comma-separated list of additional directories to search

C<RAKUDOC_DATA> is a path to the directory where Rakudoc caches pre-built
documents and search indexes.

C<RAKUDOC_PAGER> will be run to view results. If unset, then C<PAGER> will
be tried. Set C<RAKUDOC_PAGER=""> to disable the pager entirely.

=head1 SEE ALSO

=item Documentable

=item https://docs.raku.org/

=head1 LICENSE

Released under the L<Artistic License 2.0|http://www.perlfoundation.org/artistic_license_2_0>.


=end pod
